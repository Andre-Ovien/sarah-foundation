{% extends 'base.html' %}

{% block body %}
{% load static %}

<!-- Page Title -->
<div class="page-title dark-background" data-aos="fade"
     style="background-image: url('{% static "img/page-title-bg.jpg" %}');">
    <div class="container d-lg-flex justify-content-between align-items-center">
        <h1 class="mb-2 mb-lg-0">Events</h1>
        <nav class="breadcrumbs">
            <ol>
                <li><a href="index.html">Home</a></li>
                <li class="current">Events</li>
            </ol>
        </nav>
    </div>
</div><!-- End Page Title -->

<!-- Events Extended Section -->
<section id="events-extended" class="events-extended section">

    <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="row">
            <div class="col-lg-8">
                <!-- Events List -->
                <div class="events-list" id="events-list">
                    
                </div>
            </div>

            <div class="col-lg-4">
                <!-- Sidebar -->
                <div class="events-sidebar">
                    <!-- Search Form -->
                    <div class="sidebar-item search-form" data-aos="fade-up">
                        <h4>Search Events</h4>
                        <form id="search-form">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Search Events..." id="search-input">
                                <button class="btn" type="submit"><i class="bi bi-search"></i></button>
                            </div>
                        </form>
                    </div><!-- End Search Form -->

                    <!-- Upcoming Featured Events -->
                    <div class="sidebar-item upcoming-events" data-aos="fade-up" data-aos-delay="200">
                        <h4>Upcoming Featured Events</h4>
                        <div id="featured-event">
                            
                        </div>
                    </div><!-- End Upcoming Events -->

                    <!-- Event Calendar -->
                    <div class="sidebar-item event-calendar" data-aos="fade-up" data-aos-delay="300">
                        <h4>Event Calendar</h4>
                        <div class="calendar-widget">
                            <div class="calendar-header">
                                <h5>September 2025</h5>
                                <div class="calendar-nav">
                                    <a href="#" class="prev-month"><i class="bi bi-chevron-left"></i></a>
                                    <a href="#" class="next-month"><i class="bi bi-chevron-right"></i></a>
                                </div>
                            </div>
                            <table class="calendar-table">
                                <thead>
                                    <tr>
                                        <th>S</th><th>M</th><th>T</th><th>W</th><th>T</th><th>F</th><th>S</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    
                                </tbody>
                            </table>
                        </div>
                    </div><!-- End Event Calendar -->
                </div><!-- End Sidebar -->
            </div>
        </div>

    </div>

</section><!-- /Events Extended Section -->


<script>
document.addEventListener("DOMContentLoaded", () => {
    const eventsListContainer = document.getElementById("events-list");

    fetch("/api/events/") 
        .then(res => res.json())
        .then(events => {
            eventsListContainer.innerHTML = "";

            events.forEach(event => {
                const dateObj = new Date(event.date);
                const day = dateObj.getDate() + (["st","nd","rd","th"][(dateObj.getDate() % 10)-1] || "th");
                const month = dateObj.toLocaleString('default', { month: 'long' });

                const eventItem = document.createElement("div");
                eventItem.classList.add("event-item");
                eventItem.setAttribute("data-aos", "fade-up");

                eventItem.innerHTML = `
                    <div class="event-date">
                        <span class="day">${day}</span>
                        <span class="month">${month}</span>
                    </div>
                    <div class="event-content">
                        <h3 class="event-title">${event.title}</h3>
                        <div class="event-meta">
                            <span><i class="bi bi-clock"></i> ${event.start_time} - ${event.end_time}</span>
                            <span><i class="bi bi-geo-alt"></i> ${event.location}</span>
                        </div>
                        <p class="event-description">${event.text}</p>
                        <a href="/api/events/details/${event.id}/" class="btn-event-details">Learn More <i class="bi bi-arrow-right"></i></a>
                    </div>
                `;
                eventsListContainer.appendChild(eventItem);
            });
        });

    //Search form filter
    document.getElementById("search-form").addEventListener("submit", e => {
        e.preventDefault();
        const query = document.getElementById("search-input").value.toLowerCase();
        Array.from(eventsListContainer.children).forEach(eventItem => {
            const title = eventItem.querySelector(".event-title").textContent.toLowerCase();
            eventItem.style.display = title.includes(query) ? "" : "none";
        });
    });
});
</script>

{% endblock %}
